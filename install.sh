#!/bin/sh

# fail on error
set -e

echo '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
lnMVDmgAcN20+RakdKamaki/c5u+pAvEkYNLvlM=' | base64 --decode > /usr/share/keyrings/adoptopenjdk-archive-keyring.gpg

echo 'deb [arch=amd64 signed-by=/usr/share/keyrings/adoptopenjdk-archive-keyring.gpg] https://adoptopenjdk.jfrog.io/adoptopenjdk/deb bullseye main' > /etc/apt/sources.list.d/adoptopenjdk.list

echo 'mQENBE1IjVEBCACz+LE+NY8Y8vp7VIT7z4rkAlX6GtAwGL18J9xfbC3h/8mef++/c4nJVWKprM1t
XvdFSvqckty7fVKyfDMnSP8ja2sNTSXcx9sh1q5mUOZUZUOyCuf9xEgch30eEuUAWJOu9p97N6i8
ahNKf+PtO+IE+vT19VBSYNw9Zdmy8rdNtyOoDmxJzS/lw4bo4omFImfmxvnRyFkP82pswOAy5SiR
vdgiK7oW2ChU4CFDmNsEJzw3Mq5VNT6KUFqXRgeFVcaHgR0sAdxQL1q0ezibw553ffBViNSvRBfn
6XvAfjrUkYL4sVvgMpp1wmSTZw1z8oenIzxtnxFopSf27GMqSvuDABEBAAG0JVVuaUZpIERldmVs
b3BlcnMgPHVuaWZpLWRldkB1Ym50LmNvbT6JATgEEwECACIFAk1IjVECGwMGCwkIBwMCBhUIAgkK
CwQWAgMBAh4BAheAAAoJEAboV2DApSxQFVoH/AxB2yzB72rhMUNYVr6wsVyWrzPpS7AZKv9z8U8I
hYcNdjhmAhZxw3HQ0YZPAQWsuh2ZCSnxW4oSE8qgSXMEMmR5lSq4okSWEsDziwdopR5RW1UR0cpD
SrV1YK6mbH/ZDYv8WPGZ7ZVfzon02aPik/rp1TSe7p10NML88p7Gxt7kFDt7aBhVNrzyxQts208d
pilPoOsts9SnCIypBBVO4jJ6GnUXR5quKib32ZrD8+IpeFa9/idK8RaMvoiH5ra6w7jSWxY0DffH
8rjPwsHkPgnuhJ9B5clJ0NDBRtv4L7OSBJGorbe8GjB2lf/aMkq+PkXaLC34+pX8PrG/n/beN6+w
AgADuQENBE1IjVEBCAC3Ripw/OfxnR1ZFdGgL4yoWoZsqAqbBoMojXWphHStUEx7EUa9ETwqrT2a
pEsed/8P2QjNJHhf3bGRBxEwBA5zrFp5rafCz3tj3loNi7qR+4I4p1CtURBgy7DLsJ9/7CGCbo2h
oPApvYdBpm1lq5TEWy7YzL8TnLLdwrSRGI520P2GVeyicY0lBX1Ud2fMfFtYY1G6A7umYmtBOo97
6hsZeVs0M7CT02amxEj6NjdEvKPFGLp6cUT1OI9A3JOLrtT14pcHVchZ2OD/bVx/IrgYGGvBtKm1
D2QDFEn1OUtdbCZthbk2CU/m/jCD/d6P1EVnQ5zTtk98sM3exAbhQCqVABEBAAGJAR8EGAECAAkF
Ak1IjVECGwwACgkQBuhXYMClLFAVmgf/bCiM6j5lgK0byWJO8ipHK/d3AxANfeN6ZrLlrUQhbM0h
/QBHcSwbW3wy1qUD2E8vMhtBwSFbUACMJNrmV4PzA7oFfojq+o3VIAy/mmHsRxFrjSkA45wlg92s
V5TwAYHo8NJJPw80KtqlDuAU/zhvg0S8DxEmN8F4laXHOm0sx23HyMnwApl1kIqfMlw1we02fbOa
gpvr+ol1wRuqmrsJp6e26sq+dtZGTnhJkGtcoU2JdajjEm93gLBj87DEm/xbQIVFWjCdQ2xfCgah
q48r9ECTKD3ufb+FgZTYYSDm5dn8i0DO1xmO64c9Dc2oFC2607zlzq34EkS3SJ6S3BA52bACAAM=' | base64 --decode > /usr/share/keyrings/unifi-archive-keyring.gpg

echo 'deb [arch=amd64 signed-by=/usr/share/keyrings/unifi-archive-keyring.gpg] https://www.ui.com/downloads/unifi/debian stable ubiquiti' > /etc/apt/sources.list.d/100-ubnt-unifi.list

echo 'mQINBFhRi/gBEADP0j1HExwry0VUVraDmh21uaeAOM0wzU7F+il8kKuXJeLKWsw3gfANgMxq5VqD
OnVlZBNyn5jc6bShLCZvCFQhL8NBIKUUbAr1SgoutlqjvNNmJWrLAH5hUkFLQ7mLT5rdrKtAV0nc
tlr5dYVdnpqoL1oJFmfKrV+nwPlt5NKe6B0c4pmnWLv9eH0hu0iwrnnccHKrZFis4eKLQrbvGMMa
E+xBwYYXhYcdKp0NHMcjMTXHq1JpSGpFp6H2zMb1JYla+dgnmNMts280OMKiDZumRtn/f1hOgjiP
U0EbdhvsgleFBGz6BPOJ7yRjzDtoBHBirwcLiOVyjtUEtJWj+TQbfN/cKbOG/cwqYR0v8mAmhROh
YCXmumNgPtD5hTUgg/4wXxgx+2WLhp4SKy5xxZ21WSyOR7YPgGnp7sYco1wc5yisXFFLo2hqeZcD
CwWSEcMTUQzCt4erkIKbnpd4WTES9WH4Fibid9dBtF/bRDZbdJjaxbSceR0tXrTLzaETZluU173k
rPTaj1YuH0eKJj0b5+RgKGHi7OI8SnQBUz5Rcz44KJiR3NBLV/gUw96nMYaxDdnXr9+PsYRBav0g
MHF82hCFqq4bwSgRu430Myr++K1b/RZRTGFPRrpLhR1ni/R/yObrDwm+ZR9D/V+0zJmUrejhXgSK
jyimZuvdz5yF+wARAQABtDdNb25nb0RCIDMuNiBSZWxlYXNlIFNpZ25pbmcgS2V5IDxwYWNrYWdp
bmdAbW9uZ29kYi5jb20+iQI+BBMBAgAoAhsDBgsJCAcDAgYVCAIJCgsEFgIDAQIeAQIXgAUCXA6Z
mgUJDSMO/gAKCRBYcSoikfpK1QnBEACQVjnrxtr8tvs1SJ1ORnfUKazf0SL4c8wHC3y/SxaWbZqf
MiEddeDkWk/6pSYJhoJRZliSVJ8+FvB44J5ddHhzFGAPTrmuy4zNqoSkRNjSAoEABkLMwE5Iv7IE
NHtFWfvVYlQ1UACwtsFKdm8iFQ7RnKl+pF/L/m7IfrNzgyU5xN6U3v3rZXKuSFbMFcD0W+z6+0ki
n+QtcvE4lPO1ahIBfVatOOZQyagi1fYt1dApQWxtbFK2zq8leoz9qQFwtw3POSBfrJjmu/JldYHY
LRMKFrs31NHPe/wcfw8+rGBgzCvJxsKRTjPgz1n9CQc5IX1v2T+mJPWz4bt1fw4uL2+knLj69rDB
WjapJrlTLg4NRw90B+k/m3UKc/Yyz6O4YVgeW+k0ndEX89Db9CIT14QEkloTmzvOQxLbRCLgI7nX
7NrWSrjZ9e59WQ3EZ+KGFts+7cJWpm/GfuwZc8JkYy7eHn8eko3pMhFyf5u4Gmz+ZWliEr1p5Jfo
IgqL5d7zcecNyWzyJ9liVg4n1xC3SnmclaufamqA+I/KN81j1OqbLHwN8OwBNeuYqDsFak3bnK2L
+MwCCubI8lC9Lmwebw3lwRPZVC70byOOVNADCDrk8JQyp2p/cY6hDbmgIuzfRH5Rx3Sb7DACxa5U
mOBpNDOxKLaDBWWSfey40FOow+cRyw==' | base64 --decode > /usr/share/keyrings/mongodb-archive-keyring.gpg

echo 'deb [arch=amd64 signed-by=/usr/share/keyrings/mongodb-archive-keyring.gpg] https://repo.mongodb.org/apt/debian jessie/mongodb-org/3.6 main' > /etc/apt/sources.list.d/mongodb.list

apt update

# install java
apt install adoptopenjdk-8-hotspot-jre --no-install-recommends -y

# install mongodb
wget http://ftp.de.debian.org/debian/pool/main/g/glibc/multiarch-support_2.28-10_amd64.deb
dpkg -i multiarch-support_2.28-10_amd64.deb && rm multiarch-support_2.28-10_amd64.deb

wget https://security.debian.org/debian-security/pool/updates/main/o/openssl/libssl1.0.0_1.0.1t-1+deb8u12_amd64.deb
dpkg -i libssl1.0.0_1.0.1t-1+deb8u12_amd64.deb && rm libssl1.0.0_1.0.1t-1+deb8u12_amd64.deb

apt install mongodb-org-server
systemctl enable --now mongod.service

# install unifi
echo 'JAVA_HOME="$( readlink -f "$( which java )" | sed "s:bin/.*$::" )"' > /etc/default/unifi
apt install unifi --no-install-recommends -y
